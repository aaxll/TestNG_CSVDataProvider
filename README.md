Based on https://gist.github.com/djangofan/7027833  